<% content_for :breadcrumbs do %>
  <li><%= link_to "Events", admin_events_path %></li>
  <li><%= @event.title %></li>
<% end %>

<% content_for :page_actions do %>
  <div class="flex space-x-2">
    <%= link_to edit_admin_event_path(@event), class: "btn btn-primary btn-sm" do %>
      <i class="fas fa-edit mr-2"></i>
      Edit Event
    <% end %>
    <%= link_to admin_event_path(@event), class: "btn btn-error btn-sm", data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this event? This will also delete all associated data." } do %>
      <i class="fas fa-trash mr-2"></i>
      Delete
    <% end %>
  </div>
<% end %>

<!-- Event Header -->
<div class="card bg-base-100 shadow-xl mb-6">
  <div class="card-body">
    <div class="flex items-start justify-between">
      <div class="flex items-center space-x-4">
        <div class="avatar placeholder">
          <div class="bg-primary text-primary-content rounded-full w-16">
            <span class="text-2xl"><%= @event.title.first.upcase %></span>
          </div>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-base-content"><%= @event.title %></h1>
          <div class="flex items-center space-x-4 mt-2 text-base-content/70">
            <div class="flex items-center space-x-1">
              <i class="fas fa-calendar-alt"></i>
              <span><%= @event.date.strftime("%B %d, %Y at %I:%M %p") %></span>
            </div>
            <div class="flex items-center space-x-1">
              <i class="fas fa-map-marker-alt"></i>
              <span><%= @event.location %></span>
            </div>
          </div>
          <% if @event.date < Time.current %>
            <div class="badge badge-ghost mt-2">Past Event</div>
          <% elsif @event.date < 1.week.from_now %>
            <div class="badge badge-warning mt-2">Upcoming Soon</div>
          <% else %>
            <div class="badge badge-success mt-2">Upcoming</div>
          <% end %>
        </div>
      </div>
    </div>
    
    <% if @event.description.present? %>
      <div class="mt-4">
        <h3 class="font-semibold text-base-content mb-2">Description</h3>
        <p class="text-base-content/80"><%= @event.description %></p>
      </div>
    <% end %>
  </div>
</div>

<!-- Statistics -->
<div class="stats shadow mb-6 w-full">
  <div class="stat">
    <div class="stat-figure text-primary">
      <i class="fas fa-users text-2xl"></i>
    </div>
    <div class="stat-title">Registered Users</div>
    <div class="stat-value text-primary"><%= @users.count %></div>
  </div>
  
  <div class="stat">
    <div class="stat-figure text-secondary">
      <i class="fas fa-microphone text-2xl"></i>
    </div>
    <div class="stat-title">Performers</div>
    <div class="stat-value text-secondary"><%= @performers.count %></div>
  </div>
  
  <div class="stat">
    <div class="stat-figure text-accent">
      <i class="fas fa-hand-holding-usd text-2xl"></i>
    </div>
    <div class="stat-title">Tips Received</div>
    <div class="stat-value text-accent"><%= @tips.count %></div>
  </div>
  
  <div class="stat">
    <div class="stat-figure text-success">
      <i class="fas fa-dollar-sign text-2xl"></i>
    </div>
    <div class="stat-title">Total Amount</div>
    <div class="stat-value text-success">$<%= @total_tips.to_i %></div>
  </div>
</div>

<!-- Associated Users -->
<div class="card bg-base-100 shadow-xl mb-6">
  <div class="card-body">
    <h2 class="card-title text-xl mb-4">
      <i class="fas fa-users text-primary"></i>
      Associated Users
      <span class="badge badge-primary badge-sm"><%= @event.users.count %></span>
    </h2>
    
    <% if @event.users.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <% @event.users.each do |user| %>
          <div class="card bg-base-200 shadow-sm">
            <div class="card-body p-4">
              <div class="flex items-center space-x-3">
                <div class="avatar">
                  <div class="w-10 rounded-full">
                    <%= user_avatar_image(user, size: :thumb, css_classes: "w-10 h-10 rounded-full object-cover") %>
                  </div>
                </div>
                <div class="flex-1 min-w-0">
                  <h3 class="font-medium text-base-content truncate">
                    <%= link_to user.name, admin_user_path(user), 
                        class: "link link-primary hover:link-primary-focus" %>
                  </h3>
                  <p class="text-sm text-base-content/70 truncate">
                    <%= user.email %>
                  </p>
                  <div class="flex items-center space-x-2 mt-1">
                    <% if user.admin? %>
                      <span class="badge badge-primary badge-xs">Admin</span>
                    <% end %>
                    <span class="text-xs text-base-content/60">
                      <%= pluralize(user.tips.where(event: @event).count, 'tip') %>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8">
        <i class="fas fa-user-times text-base-content/40 text-4xl mb-4"></i>
        <p class="text-base-content/60 mb-4">No users are associated with this event yet.</p>
        <p class="text-sm text-base-content/50">Users can be associated with events through the user management section.</p>
      </div>
    <% end %>
  </div>
</div>

<!-- Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Recent Tips -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <div class="flex items-center justify-between mb-4">
        <h2 class="card-title">
          <i class="fas fa-dollar-sign mr-2"></i>
          Recent Tips
        </h2>
        <%= link_to admin_tips_path(event_id: @event.id), class: "btn btn-sm btn-outline" do %>
          View All
        <% end %>
      </div>
      
      <% if @tips.any? %>
        <div class="space-y-3">
          <% @tips.each do |tip| %>
            <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg">
              <div class="flex items-center space-x-3">
                <div class="avatar">
                  <div class="w-8 rounded-full">
                    <%= user_avatar_image(tip.user, size: :thumb, css_classes: "w-8 h-8 rounded-full object-cover") %>
                  </div>
                </div>
                <div>
                  <h3 class="font-semibold text-base-content"><%= tip.user.name %></h3>
                  <% if tip.message.present? %>
                    <p class="text-sm text-base-content/70 italic">"<%= truncate(tip.message, length: 40) %>"</p>
                  <% end %>
                </div>
              </div>
              <div class="text-right">
                <div class="badge badge-success font-bold">$<%= tip.amount.to_f %></div>
                <p class="text-xs text-base-content/50"><%= time_ago_in_words(tip.created_at) %> ago</p>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <i class="fas fa-hand-holding-usd text-4xl text-base-content/30 mb-4"></i>
          <p class="text-base-content/70">No tips received yet</p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Performers -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <div class="flex items-center justify-between mb-4">
        <h2 class="card-title">
          <i class="fas fa-microphone mr-2"></i>
          Performers
        </h2>
        <%= link_to new_admin_performer_path(event_id: @event.id), class: "btn btn-sm btn-primary" do %>
          <i class="fas fa-plus mr-1"></i>
          Add
        <% end %>
      </div>
      
      <% if @performers.any? %>
        <div class="space-y-3">
          <% @performers.each do |performer| %>
            <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg">
              <div class="flex items-center space-x-3">
                <div class="avatar">
                  <div class="w-10 rounded-full">
                    <%= user_avatar_image(performer, size: :thumb, css_classes: "w-10 h-10 rounded-full object-cover") %>
                  </div>
                </div>
                <div>
                  <h3 class="font-semibold text-base-content">
                    <%= link_to performer.name, admin_performer_path(performer), class: "hover:text-primary" %>
                  </h3>
                  <p class="text-sm text-base-content/70"><%= performer.genre %></p>
                </div>
              </div>
              <div class="flex space-x-1">
                <%= link_to admin_performer_path(performer), class: "btn btn-ghost btn-xs" do %>
                  <i class="fas fa-eye"></i>
                <% end %>
                <%= link_to edit_admin_performer_path(performer), class: "btn btn-ghost btn-xs" do %>
                  <i class="fas fa-edit"></i>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <i class="fas fa-microphone-slash text-4xl text-base-content/30 mb-4"></i>
          <p class="text-base-content/70">No performers added yet</p>
          <%= link_to new_admin_performer_path(event_id: @event.id), class: "btn btn-primary btn-sm mt-2" do %>
            <i class="fas fa-plus mr-2"></i>
            Add Performer
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

<!-- Users Section -->
<div class="card bg-base-100 shadow-xl mt-6">
  <div class="card-body">
    <div class="flex items-center justify-between mb-4">
      <h2 class="card-title">
        <i class="fas fa-users mr-2"></i>
        Registered Users
      </h2>
      <%= link_to admin_users_path(event_id: @event.id), class: "btn btn-sm btn-outline" do %>
        View All Users
      <% end %>
    </div>
    
    <% if @users.any? %>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Tips Given</th>
              <th>Total Amount</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <% user_tips = user.tips.where(event: @event) %>
              <tr>
                <td>
                  <div class="flex items-center space-x-3">
                    <div class="avatar">
                      <div class="w-8 rounded-full">
                        <%= user_avatar_image(user, size: :thumb, css_classes: "w-8 h-8 rounded-full object-cover") %>
                      </div>
                    </div>
                    <div>
                      <div class="font-bold">
                        <%= link_to user.name, admin_user_path(user), class: "hover:text-primary" %>
                      </div>
                      <% if user.admin? %>
                        <div class="badge badge-warning badge-xs">Admin</div>
                      <% end %>
                    </div>
                  </div>
                </td>
                <td><%= user.email %></td>
                <td><%= user_tips.count %></td>
                <td>$<%= user_tips.sum(:amount).to_f %></td>
                <td>
                  <%= link_to admin_user_path(user), class: "btn btn-ghost btn-xs" do %>
                    <i class="fas fa-eye"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-8">
        <i class="fas fa-user-plus text-4xl text-base-content/30 mb-4"></i>
        <p class="text-base-content/70">No users registered for this event yet</p>
      </div>
    <% end %>
  </div>
</div>
