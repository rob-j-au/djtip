<% content_for :breadcrumbs do %>
  <li>Events</li>
<% end %>

<% content_for :page_actions do %>
  <%= link_to new_new_admin_event_path, class: "btn btn-primary" do %>
    <i class="fas fa-plus mr-2"></i>
    New Event
  <% end %>
<% end %>

<!-- Search and Filters -->
<div class="card bg-base-100 shadow-sm mb-6">
  <div class="card-body">
    <%= form_with url: new_admin_events_path, method: :get, local: true, class: "flex flex-wrap gap-4 items-end" do |f| %>
      <div class="form-control flex-1 min-w-64">
        <%= f.label :search, "Search Events", class: "label" %>
        <%= f.text_field :search, value: params[:search], placeholder: "Search by title, location, or description...", 
            class: "input input-bordered w-full" %>
      </div>
      
      <div class="form-control">
        <%= f.label :date_filter, "Date Filter", class: "label" %>
        <%= f.select :date_filter, 
            options_for_select([
              ['All Events', ''],
              ['Upcoming Events', 'upcoming'],
              ['Past Events', 'past'],
              ['This Month', 'this_month']
            ], params[:date_filter]), 
            {}, { class: "select select-bordered" } %>
      </div>
      
      <div class="form-control">
        <%= f.submit "Filter", class: "btn btn-primary" %>
        <%= link_to "Clear", new_admin_events_path, class: "btn btn-ghost" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Events Table -->
<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <% if @events.any? %>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>Event</th>
              <th>Date & Time</th>
              <th>Location</th>
              <th>Stats</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @events.each do |event| %>
              <tr class="hover">
                <td>
                  <div class="flex items-center space-x-3">
                    <div class="avatar placeholder">
                      <div class="bg-primary text-primary-content rounded-full w-12">
                        <span class="text-xl"><%= event.title.first.upcase %></span>
                      </div>
                    </div>
                    <div>
                      <div class="font-bold text-base-content">
                        <%= link_to event.title, new_admin_event_path(event), class: "hover:text-primary" %>
                      </div>
                      <% if event.description.present? %>
                        <div class="text-sm text-base-content/70">
                          <%= truncate(event.description, length: 60) %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </td>
                
                <td>
                  <div class="text-sm">
                    <div class="font-semibold text-base-content">
                      <%= event.date.strftime("%B %d, %Y") %>
                    </div>
                    <div class="text-base-content/70">
                      <%= event.date.strftime("%I:%M %p") %>
                    </div>
                    <% if event.date < Time.current %>
                      <div class="badge badge-ghost badge-sm">Past</div>
                    <% elsif event.date < 1.week.from_now %>
                      <div class="badge badge-warning badge-sm">Soon</div>
                    <% else %>
                      <div class="badge badge-success badge-sm">Upcoming</div>
                    <% end %>
                  </div>
                </td>
                
                <td>
                  <div class="text-sm">
                    <i class="fas fa-map-marker-alt text-base-content/50 mr-1"></i>
                    <%= event.location %>
                  </div>
                </td>
                
                <td>
                  <div class="flex flex-col space-y-1">
                    <div class="badge badge-primary badge-sm">
                      <i class="fas fa-users mr-1"></i>
                      <%= pluralize(event.users.count, 'user') %>
                    </div>
                    <div class="badge badge-secondary badge-sm">
                      <i class="fas fa-microphone mr-1"></i>
                      <%= pluralize(event.performers.count, 'performer') %>
                    </div>
                    <div class="badge badge-success badge-sm">
                      <i class="fas fa-dollar-sign mr-1"></i>
                      $<%= event.tips.sum(:amount).to_i %>
                    </div>
                  </div>
                </td>
                
                <td>
                  <div class="flex space-x-1">
                    <%= link_to new_admin_event_path(event), class: "btn btn-ghost btn-sm" do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                    <%= link_to edit_new_admin_event_path(event), class: "btn btn-ghost btn-sm" do %>
                      <i class="fas fa-edit"></i>
                    <% end %>
                    <%= link_to new_admin_event_path(event), method: :delete, 
                        class: "btn btn-ghost btn-sm text-error",
                        confirm: "Are you sure you want to delete this event? This will also delete all associated users, performers, and tips." do %>
                      <i class="fas fa-trash"></i>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      
      <!-- Pagination would go here if using Pagy or Kaminari -->
      <% if defined?(@pagy) %>
        <div class="flex justify-center mt-6">
          <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
        </div>
      <% end %>
      
    <% else %>
      <!-- Empty State -->
      <div class="text-center py-12">
        <div class="w-24 h-24 bg-base-200 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-calendar-plus text-3xl text-base-content/30"></i>
        </div>
        <h3 class="text-xl font-semibold text-base-content mb-2">No events found</h3>
        <% if params[:search].present? || params[:date_filter].present? %>
          <p class="text-base-content/70 mb-4">Try adjusting your search criteria</p>
          <%= link_to "Clear filters", new_admin_events_path, class: "btn btn-ghost mr-2" %>
        <% else %>
          <p class="text-base-content/70 mb-4">Get started by creating your first event</p>
        <% end %>
        <%= link_to new_new_admin_event_path, class: "btn btn-primary" do %>
          <i class="fas fa-plus mr-2"></i>
          Create Event
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<!-- Summary Stats -->
<% if @events.any? %>
  <div class="stats shadow mt-6 w-full">
    <div class="stat">
      <div class="stat-figure text-primary">
        <i class="fas fa-calendar-alt text-2xl"></i>
      </div>
      <div class="stat-title">Total Events</div>
      <div class="stat-value text-primary"><%= @events.count %></div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-secondary">
        <i class="fas fa-users text-2xl"></i>
      </div>
      <div class="stat-title">Total Attendees</div>
      <div class="stat-value text-secondary"><%= @events.sum { |e| e.users.count } %></div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-accent">
        <i class="fas fa-microphone text-2xl"></i>
      </div>
      <div class="stat-title">Total Performers</div>
      <div class="stat-value text-accent"><%= @events.sum { |e| e.performers.count } %></div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-success">
        <i class="fas fa-dollar-sign text-2xl"></i>
      </div>
      <div class="stat-title">Total Tips</div>
      <div class="stat-value text-success">$<%= @events.sum { |e| e.tips.sum(:amount) }.to_i %></div>
    </div>
  </div>
<% end %>
